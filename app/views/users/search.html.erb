<div class="wrapper">
  <div class="page-content padded">
    <div class="container-fluid main">
      <div id="search-filter">
        <form action="/search">
          <div class="row">
            <div class="col-xs-12 col-sm-4">
              <div class="row-fluid">
                <div class="col-xs-12">
                  <input class="search-input full-input" placeholder="Ville ou adresse" name="location" id="user_input_autocomplete_address" value="<%= @location %>">
                </div>
              </div>
              <div class="row-fluid">
                <div class="col-xs-12">
                  <select class="search-input select-height full-input" placeholder="Spécialité" name="speciality">
                    <option class="search-input" value="generalist">Médecine générale</option>
                    <option class="search-input" value="kine">Kinésithérapie</option>
                    <option class="search-input" value="specialist">Autre spécialité</option>
                  </select>
                </div>
              </div>
              <div class="row-fluid">
                <div class="col-xs-12 col-sm-6">
                  <input type="text" class="search-input datepick" placeholder="Date de début" name="start_date">
                </div>
                <div class="col-xs-12 col-sm-6">
                  <input type="text" class="search-input datepick" placeholder="Date de fin" name="end_date">
                </div>
              </div>
            </div>
            <div class="col-xs-12 col-sm-8">
              <div class="row-fluid">
                <div class="col-xs-12">
                  <div class="option-flex filter-row">
                    <div class="label-option">
                      <label for="commission">Reversement au remplaçant</label>
                    </div>
                    <div class="slider-values">
                      <input type="text" name="commission" class="text-center slider-values-text" id="commission" readonly>
                    </div>
                    <div class="slider-bar">
                      <div id="slider-range"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row-fluid">
                <div class="col-xs-12">
                  <div class="option-flex filter-row">
                    <div class="label-option">
                      <label for="rating">Note des profils</label>
                    </div>
                    <div class="slider-values">
                      <input type="text" name="rating" class="text-center slider-values-text" id="rating" readonly>
                    </div>
                    <div class="slider-bar">
                      <div id="slider-range2"></div>
                    </div>
                    <div class="slider-margin"></div>
                    <div class="slider-addon checkbox hidden-xs">
                      <label><input type="checkbox" name="unrated" value="on" checked> Inclure les profils non-notés</label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row-fluid">
                <div class="col-xs-12">
                  <div class="option-flex filter-row">
                    <div class="label-option-small">
                      <div class="form-group">
                        <label>Convention </label>
                        <select name="convention" class="search-input">
                          <option value="both">Tout</option>
                          <option value="1">1</option>
                          <option value="2">2</option>
                        </select>
                      </div>
                    </div>
                    <div class="label-option-small">
                      <div class="checkbox">
                        <label><input type="checkbox" name="housing" class="search-input"> Hébergement</label>
                      </div>
                    </div>
                    <div class="label-option-small">
                      <div class="checkbox">
                        <label><input type="checkbox" name="secretary" class="search-input"> Secrétariat</label>
                      </div>
                    </div>
                    <div class="label-option-large">
                      <div class="form-group">
                        <label>Visites à domicile </label>
                        <select name="home-visits" class="search-input">
                          <option value="none">Aucune</option>
                          <option value="max2"><= 2 par jour</option>
                          <option value="above2">> 2 par jour</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12 text-center" id="filter-button">
              <input type="submit" value="Filtrer" class="btn btn-primary" id="filter-button" style="width: 33%;">
            </div>
          </div>
        </form>
      </div>
      <div class="row">
        <div class="col-xs-12 text-center hide-filter">

          <span class="hide-arrow"><i class="fa fa-arrow-circle-o-up align-center"></i></span>
          <span class="hide-arrow hidden"><i class="fa fa-arrow-circle-o-down align-center"></i></span>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 text-center hide-filter" style="box-shadow: none;">
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12 col-sm-8">
          <div class="cards">
            <div class="container-fluid">
              <div class="row">
                <% if @users.first.nil? %>
                  <h4 class="text-center">Sorry, there is no result in your area.</h4>
                <% end %>
                <% @users.each do |user| %>
                <div class="col-xs-12">
                  <%= link_to user_path(user) do %>
                    <div class="card-user" id="user-<%= user.id %>">
                      <div class="card-avatar">
                        <% if user.avatar.nil? %>
                          <%= image_tag "placeholder_pic.png", class: "avatar-xxl" %>
                        <% else %>
                          <%= image_tag user.avatar, class: "avatar-xxl" %>
                        <% end %>
                      </div>
                      <div class="card-content-left">
                        <h4>Dr. <%= user.first_name %>  <%= user.last_name %></h4>
                        <% if user.reviews.size > 0 %>
                          <h4>
                            <%= ("<i class='fa fa-star fa-yellow'></i>" * user.reviews.average(:rating).to_f.round).html_safe %>
                            <%= ("<i class='fa fa-star fa-gray'></i>" * (5 - user.reviews.average(:rating).to_f.round)).html_safe %>
                          </h4>
                        <% end %>
                        <h5><%= user.speciality %></h5>
                        <h6><%= user.address %></h6>
                      </div>
                      <div class="card-content-right">

                      </div>
                    </div>
                  <% end %>
                </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
        <div class="hidden-xs col-sm-4 no-padding map">
          <div id="map" style="position: fixed;"></div>
          <% content_for(:after_js) do %>
            <script> <%#= javascript_tag do %>
              $(document).on('ready', function() {
                hoverPicture = {
                url: "<%= asset_path 'marker_blue_small.png' %>",
                width: 60,
                height: 90
                };
                handler = Gmaps.build('Google');
                handler.buildMap({ internal: { id: 'map' } }, function(){
                  markers = handler.addMarkers(<%= raw @markers.to_json %>);

                  (<%=raw @markers.to_json %>).forEach(function(json, index){
                    json.marker = markers[index];

                    json.marker.serviceObject.addListener('click', function() {
                      console.log("click");
                      $('.card-user').removeClass('highlighted-card');
                      $('#user-' + json.id).addClass('highlighted-card');
                      document.getElementById('user-' + json.id).scrollIntoView();
                      var scrolledY = window.scrollY
                      if(scrolledY) {
                        window.scroll(0, scrolledY - '75px');
                      }
                    });

                    gr = {};
                    gr.marker = void 0;
                    $("#user-" + json.id).on('mouseenter', function() {
                      gr = { lat: json.lat, lng: json.lng, picture: hoverPicture };
                      handler.removeMarker(json.marker);
                      gr.marker = handler.addMarker(gr);
                      }).on("mouseleave", function() {
                          handler.removeMarker(gr.marker);
                          json.marker = handler.addMarker(json);
                        });
                  });
                  handler.bounds.extendWith(markers);
                  handler.fitMapToBounds();
                });
              });
            </script> <%# end %>
          <% end %>
        </div>
      </div>


    </div>
  </div>
</div>
